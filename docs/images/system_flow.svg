<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800">
  <style>
    .box { fill: #f7fafc; stroke: #2d3748; stroke-width: 2; rx: 8; }
    .title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #1a202c; }
    .text { font-family: Arial, sans-serif; font-size: 14px; fill: #2d3748; }
    .arrow { stroke: #2d3748; stroke-width: 2; marker-end: url(#arrowhead); }
    .lane { fill: #edf2f7; opacity: 0.6; }
    .label { font-family: Arial, sans-serif; font-size: 16px; fill: #2d3748; font-weight: bold; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2d3748" />
    </marker>
  </defs>

  <!-- Lanes -->
  <rect x="40" y="60" width="1120" height="300" class="lane" />
  <text x="50" y="50" class="label">离线文档处理</text>
  <rect x="40" y="420" width="1120" height="300" class="lane" />
  <text x="50" y="410" class="label">在线查询处理</text>

  <!-- Offline: Input Docs -->
  <rect x="70" y="100" width="160" height="60" class="box" />
  <text x="80" y="135" class="title">原始文档</text>
  <text x="80" y="155" class="text">PDF / MD / Web / etc.</text>

  <!-- Chunker -->
  <rect x="260" y="100" width="180" height="60" class="box" />
  <text x="270" y="135" class="title">分块 Chunker</text>
  <text x="270" y="155" class="text">结构化切分</text>
  <line x1="230" y1="130" x2="260" y2="130" class="arrow" />

  <!-- Atomic Note Generator -->
  <rect x="470" y="100" width="220" height="60" class="box" />
  <text x="480" y="135" class="title">原子笔记生成</text>
  <text x="480" y="155" class="text">LLM / 并行任务</text>
  <line x1="440" y1="130" x2="470" y2="130" class="arrow" />

  <!-- Embeddings & Clustering -->
  <rect x="720" y="100" width="200" height="60" class="box" />
  <text x="730" y="135" class="title">嵌入 & 聚类</text>
  <text x="730" y="155" class="text">EmbeddingManager / Clustering</text>
  <line x1="690" y1="130" x2="720" y2="130" class="arrow" />

  <!-- Graph Builder -->
  <rect x="950" y="100" width="180" height="60" class="box" />
  <text x="960" y="135" class="title">图谱构建</text>
  <text x="960" y="155" class="text">GraphBuilder / RelationExtractor</text>
  <line x1="920" y1="130" x2="950" y2="130" class="arrow" />

  <!-- Offline outputs -->
  <rect x="260" y="200" width="220" height="60" class="box" />
  <text x="270" y="235" class="title">向量索引</text>
  <text x="270" y="255" class="text">VectorIndex / Faiss</text>
  <line x1="580" y1="160" x2="370" y2="200" class="arrow" />

  <rect x="520" y="200" width="220" height="60" class="box" />
  <text x="530" y="235" class="title">图索引</text>
  <text x="530" y="255" class="text">GraphIndex</text>
  <line x1="1040" y1="160" x2="740" y2="200" class="arrow" />

  <rect x="780" y="200" width="220" height="60" class="box" />
  <text x="790" y="235" class="title">GraphML 导出</text>
  <text x="790" y="255" class="text">graph.graphml</text>
  <line x1="1040" y1="160" x2="890" y2="200" class="arrow" />

  <!-- Online: Query -->
  <rect x="70" y="460" width="180" height="60" class="box" />
  <text x="80" y="495" class="title">用户查询</text>
  <text x="80" y="515" class="text">自然语言问题</text>

  <!-- BM25 -->
  <rect x="270" y="460" width="160" height="60" class="box" />
  <text x="280" y="495" class="title">BM25</text>
  <text x="280" y="515" class="text">词法检索</text>
  <line x1="250" y1="490" x2="270" y2="490" class="arrow" />

  <!-- Dense Retriever -->
  <rect x="460" y="460" width="200" height="60" class="box" />
  <text x="470" y="495" class="title">向量检索</text>
  <text x="470" y="515" class="text">VectorRetriever</text>
  <line x1="430" y1="490" x2="460" y2="490" class="arrow" />

  <!-- Graph / Path -->
  <rect x="690" y="460" width="200" height="60" class="box" />
  <text x="700" y="495" class="title">图/路径增强</text>
  <text x="700" y="515" class="text">GraphRetriever / PathAware</text>
  <line x1="660" y1="490" x2="690" y2="490" class="arrow" />

  <!-- Hybrid Searcher -->
  <rect x="920" y="460" width="200" height="60" class="box" />
  <text x="930" y="495" class="title">融合排序</text>
  <text x="930" y="515" class="text">HybridSearcher (Linear/RRF)</text>
  <line x1="890" y1="490" x2="920" y2="490" class="arrow" />

  <!-- Context & Answer -->
  <rect x="260" y="560" width="230" height="60" class="box" />
  <text x="270" y="595" class="title">上下文调度</text>
  <text x="270" y="615" class="text">ContextDispatcher</text>

  <rect x="520" y="560" width="220" height="60" class="box" />
  <text x="530" y="595" class="title">答案生成</text>
  <text x="530" y="615" class="text">LLM (Local/Hybrid)</text>

  <rect x="780" y="560" width="200" height="60" class="box" />
  <text x="790" y="595" class="title">答案验证</text>
  <text x="790" y="615" class="text">SpanPicker / Verifier</text>

  <line x1="1020" y1="490" x2="375" y2="560" class="arrow" />
  <line x1="490" y1="590" x2="520" y2="590" class="arrow" />
  <line x1="740" y1="590" x2="780" y2="590" class="arrow" />
</svg>